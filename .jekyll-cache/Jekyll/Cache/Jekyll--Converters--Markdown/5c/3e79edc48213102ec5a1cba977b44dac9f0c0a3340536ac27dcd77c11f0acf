I"Ãh<h2 id="ç®€ä»‹">ç®€ä»‹</h2>

<p><img src="../assets/img/2020-08-26-dex2oat_basics/build-verbose.png" alt="build log" /></p>

<p>åœ¨æˆ‘ä»¬æ„å»ºå‡ºæ¥çš„outç›®å½•ä¸‹ï¼Œæœ‰ä¸€ä¸ªå«åšverbose.log.gzçš„æ–‡ä»¶ï¼Œæˆ‘ä»¬ä½¿ç”¨gzip -d verbose.log.gz
å¯ä»¥å¾—åˆ°ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶verbose.logï¼Œå®ƒä¿å­˜äº†åœ¨æ„å»ºæ•´ä¸ªç³»ç»Ÿçš„æ—¶å€™ï¼Œè¯¦ç»†çš„æ„å»ºæµç¨‹ã€‚</p>

<p>æˆ‘ä»¬ä»è¿™ä¸ªlogä¸­æˆªå–æ„å»ºboot.oatæ–‡ä»¶çš„æ„å»ºå‘½ä»¤</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
</pre></td> --><td class="rouge-code"><pre>[63549/63992]
mkdir -p out/soong/walleye/dex_bootjars_unstripped/system/framework/arm &amp;&amp; 
rm -f out/soong/walleye/dex_bootjars_unstripped/system/framework/arm/*.art out/soong/walleye/dex_bootjars_unstripped/system/framework/arm/*.oat out/soong/walleye/dex_bootjars_unstripped/system/framework/arm/*.invocation &amp;&amp; 
rm -f out/soong/walleye/dex_bootjars/system/framework/arm/*.art out/soong/walleye/dex_bootjars/system/framework/arm/*.oat out/soong/walleye/dex_bootjars/system/framework/arm/*.invocation &amp;&amp;
 ANDROID_LOG_TAGS="*:e" 
 out/soong/host/linux-x86/bin/dex2oatd --avoid-storing-invocation --write-invocation-to=out/soong/walleye/dex_bootjars/system/framework/arm/boot.invocation --runtime-arg -Xms64m --runtime-arg -Xmx64m 
 --compiler-filter=speed-profile 
 --profile-file=out/soong/walleye/dex_bootjars/boot.prof 
 --dirty-image-objects=frameworks/base/config/dirty-image-objects 
 --dex-file=out/soong/walleye/dex_bootjars_input/core-oj.jar 
 --dex-file=out/soong/walleye/dex_bootjars_input/core-libart.jar 
 --dex-file=out/soong/walleye/dex_bootjars_input/okhttp.jar 
 --dex-file=out/soong/walleye/dex_bootjars_input/bouncycastle.jar 
 --dex-file=out/soong/walleye/dex_bootjars_input/apache-xml.jar 
 --dex-file=out/soong/walleye/dex_bootjars_input/framework.jar 
 --dex-file=out/soong/walleye/dex_bootjars_input/ext.jar 
 --dex-file=out/soong/walleye/dex_bootjars_input/telephony-common.jar 
 --dex-file=out/soong/walleye/dex_bootjars_input/voip-common.jar 
 --dex-file=out/soong/walleye/dex_bootjars_input/ims-common.jar 
 --dex-file=out/soong/walleye/dex_bootjars_input/android.test.base.jar 
 --dex-location=/apex/com.android.runtime/javalib/core-oj.jar 
 --dex-location=/apex/com.android.runtime/javalib/core-libart.jar 
 --dex-location=/apex/com.android.runtime/javalib/okhttp.jar 
 --dex-location=/apex/com.android.runtime/javalib/bouncycastle.jar 
 --dex-location=/apex/com.android.runtime/javalib/apache-xml.jar 
 --dex-location=/system/framework/framework.jar 
 --dex-location=/system/framework/ext.jar 
 --dex-location=/system/framework/telephony-common.jar 
 --dex-location=/system/framework/voip-common.jar 
 --dex-location=/system/framework/ims-common.jar 
 --dex-location=/system/framework/android.test.base.jar 
 --generate-debug-info 
 --generate-build-id 
 --oat-symbols=out/soong/walleye/dex_bootjars_unstripped/system/framework/arm/boot.oat 
 --strip 
 --oat-file=out/soong/walleye/dex_bootjars/system/framework/arm/boot.oat 
 --oat-location=out/soong/walleye/dex_bootjars/system/framework/boot.oat 
 --image=out/soong/walleye/dex_bootjars/system/framework/arm/boot.art 
 --base=0x70000000 
 --instruction-set=arm 
 --instruction-set-variant=cortex-a73 
 --instruction-set-features=default 
 --android-root=out/empty 
 --no-inline-from=core-oj.jar 
 --abort-on-hard-verifier-error 
 --generate-mini-debug-info || ( echo 'ERROR: Dex2oat failed to compile a boot image.It is likely that the boot classpath is inconsistent.Rebuild with ART_BOOT_IMAGE_EXTRA_ARGS="--runtime-arg -verbose:verifier" to see verification errors.' ; false )
 
 [63582/63992] 
 mkdir -p out/soong/walleye/dex_bootjars_unstripped/system/framework/arm64 &amp;&amp; 
 rm -f out/soong/walleye/dex_bootjars_unstripped/system/framework/arm64/*.art out/soong/walleye/dex_bootjars_unstripped/system/framework/arm64/*.oat out/soong/walleye/dex_bootjars_unstripped/system/framework/arm64/*.invocation &amp;&amp; 
 rm -f out/soong/walleye/dex_bootjars/system/framework/arm64/*.art out/soong/walleye/dex_bootjars/system/framework/arm64/*.oat out/soong/walleye/dex_bootjars/system/framework/arm64/*.invocation &amp;&amp;
ANDROID_LOG_TAGS="*:e" out/soong/host/linux-x86/bin/dex2oatd --avoid-storing-invocation 
--write-invocation-to=out/soong/walleye/dex_bootjars/system/framework/arm64/boot.invocation --runtime-arg -Xms64m --runtime-arg -Xmx64m 
--compiler-filter=speed-profile 
--profile-file=out/soong/walleye/dex_bootjars/boot.prof 
--dirty-image-objects=frameworks/base/config/dirty-image-objects 
--dex-file=out/soong/walleye/dex_bootjars_input/core-oj.jar 
--dex-file=out/soong/walleye/dex_bootjars_input/core-libart.jar 
--dex-file=out/soong/walleye/dex_bootjars_input/okhttp.jar 
--dex-file=out/soong/walleye/dex_bootjars_input/bouncycastle.jar 
--dex-file=out/soong/walleye/dex_bootjars_input/apache-xml.jar 
--dex-file=out/soong/walleye/dex_bootjars_input/framework.jar 
--dex-file=out/soong/walleye/dex_bootjars_input/ext.jar 
--dex-file=out/soong/walleye/dex_bootjars_input/telephony-common.jar 
--dex-file=out/soong/walleye/dex_bootjars_input/voip-common.jar 
--dex-file=out/soong/walleye/dex_bootjars_input/ims-common.jar 
--dex-file=out/soong/walleye/dex_bootjars_input/android.test.base.jar 
--dex-location=/apex/com.android.runtime/javalib/core-oj.jar 
--dex-location=/apex/com.android.runtime/javalib/core-libart.jar 
--dex-location=/apex/com.android.runtime/javalib/okhttp.jar 
--dex-location=/apex/com.android.runtime/javalib/bouncycastle.jar 
--dex-location=/apex/com.android.runtime/javalib/apache-xml.jar 
--dex-location=/system/framework/framework.jar 
--dex-location=/system/framework/ext.jar 
--dex-location=/system/framework/telephony-common.jar 
--dex-location=/system/framework/voip-common.jar 
--dex-location=/system/framework/ims-common.jar 
--dex-location=/system/framework/android.test.base.jar 
--generate-debug-info --generate-build-id 
--oat-symbols=out/soong/walleye/dex_bootjars_unstripped/system/framework/arm64/boot.oat 
--strip --oat-file=out/soong/walleye/dex_bootjars/system/framework/arm64/boot.oat 
--oat-location=out/soong/walleye/dex_bootjars/system/framework/boot.oat 
--image=out/soong/walleye/dex_bootjars/system/framework/arm64/boot.art --base=0x70000000 
--instruction-set=arm64 
--instruction-set-variant=cortex-a73 
--instruction-set-features=default 
--android-root=out/empty 
--no-inline-from=core-oj.jar 
--abort-on-hard-verifier-error 
--generate-mini-debug-info || ( echo 'ERROR: Dex2oat failed to compile a boot image.It is likely that the boot classpath is inconsistent.Rebuild with ART_BOOT_IMAGE_EXTRA_ARGS="--runtime-arg -verbose:verifier" to see verification errors.' ; false )
</pre></td></tr></tbody></table></code></pre></div></div>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ° out/soong/host/linux-x86/bin/dex2oatdç¼–è¯‘boot.oatä»¥åŠboot.artçš„å‘½ä»¤ï¼Œä¸€ä¸ªæ˜¯arm ä¸€ä¸ªæ˜¯arm64
è¿™äº›æ–‡ä»¶åˆ·æœºåˆ°æ‰‹æœºä¸­åï¼Œæ˜¯æ”¾ç½®åœ¨/system/framework/arm64å’Œ/system/framework/armç›®å½•ä¸‹çš„ã€‚</p>

<p>out/soong/host/linux-x86/bin/dex2oatdçš„ç¼–è¯‘é€‰é¡¹å¯ä»¥å‚è€ƒ<a href="./2020-08-26-dex2oat_options.html">è¿™ä¸ªé¡µé¢</a></p>

<p>æŒ‘å‡ ä¸ªé€‰é¡¹å«ä¹‰</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td> --><td class="rouge-code"><pre>--dex-file=&lt;dex-file&gt;: specifies a .dex, .jar, or .apk file to compile.
    Example: --dex-file=/system/framework/core.jar

--dex-location=&lt;dex-location&gt;: specifies an alternative dex location to
    encode in the oat file for the corresponding --dex-file argument.
    Example: --dex-file=/home/build/out/system/framework/core.jar
             --dex-location=/system/framework/core.jar
</pre></td></tr></tbody></table></code></pre></div></div>
<p>å‘ï¼Œå¯¹äºcore-oj.jaræ¥è¯´ï¼Œ</p>

<p>â€“dex-location=/apex/com.android.runtime/javalib/core-oj.jar</p>

<p>â€“dex-file=out/soong/walleye/dex_bootjars_input/core-oj.jar</p>

<p>å®ƒåœ¨æœåŠ¡å™¨ä¸Šè¢«ç¼–è¯‘çš„æ—¶å€™ï¼Œå®ƒçš„ä½ç½®æ˜¯out/soong/walleye/dex_bootjars_input/core-oj.jarï¼Œ
ä½†æ˜¯è¿™ä¸ªjarå®ƒåœ¨æ‰‹æœºä¸Šçš„ä½ç½®ä¿¡æ¯æ˜¯â€“dex-location=/apex/com.android.runtime/javalib/core-oj.jar
ï¼Œä»â€“dex-locationç¼–è¯‘é€‰é¡¹çš„æè¿°ä¸­å¯ä»¥å¾—çŸ¥ï¼Œè¿™ä¸ª/apex/com.android.runtime/javalib/core-oj.jar
ä¹Ÿä¼šè¢«ç¼–ç ï¼ˆencodeï¼‰è¿›bootäº§ç‰©ä¸­ã€‚</p>

<p>æˆ‘åœ¨dex2oatä»£ç ä¸­åŠ æ‰“å°æ¥ç€ï¼Œç„¶åç¼–è¯‘aospä»£ç ï¼Œæƒ³è¦çœ‹ä¸Šé¢è¿™ä¸ªå‘½ä»¤æ‰§è¡Œçš„è¿‡ç¨‹ä¸­çš„ä¸€äº›åœ°æ–¹çš„ä¿¡æ¯ã€‚</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td> --><td class="rouge-code"><pre>LOG(ERROR) &lt;&lt; "error zheng-hanhan";
LOG(INFO) &lt;&lt; "info zheng-hanhan";
</pre></td></tr></tbody></table></code></pre></div></div>
<p>å‘ç°INFOçº§åˆ«çš„Logæ‰“å°ä¸å‡ºæ¥ï¼ŒERRORå¯ä»¥æ‰“å°å‡ºæ¥ï¼Œæ‡’å¾—å»æ‰¾è°ƒæ•´è¾“å‡ºæ—¥å¿—çº§åˆ«çš„åœ°æ–¹äº†ï¼Œåé¢éƒ½ä½¿ç”¨ERRORè¿™ä¸ªçº§åˆ«çš„æ‰“å°å‡ºæ¥å¥½äº†ã€‚</p>

<p>æˆ‘åœ¨static dex2oat::ReturnCode Dex2oat(int argc, char** argv) è¿™ä¸ªå‡½æ•°çš„ä¸‹é¢è¿™ä¸ªåœ°æ–¹åŠ äº†æ‰“å°</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td> --><td class="rouge-code"><pre>// Print the complete line when any of the following is true:
//   1) Debug build
//   2) Compiling an image
//   3) Compiling with --host
//   4) Compiling on the host (not a target build)
// Otherwise, print a stripped command line.
if (kIsDebugBuild || dex2oat-&gt;IsBootImage() || dex2oat-&gt;IsHost() || !kIsTargetBuild) {
  LOG(ERROR) &lt;&lt; CommandLine();
  LOG(ERROR) &lt;&lt; "zheng-hanhan " &lt;&lt; "dex2oat-&gt;IsBootImage()" &lt;&lt; dex2oat-&gt;IsBootImage()
            &lt;&lt; "dex2oat-&gt;IsHost()" &lt;&lt; dex2oat-&gt;IsHost() &lt;&lt; "\n"; 
} else {
  LOG(ERROR) &lt;&lt; StrippedCommandLine();
  LOG(ERROR) &lt;&lt; "zheng-hanhan " &lt;&lt; "StrippedCommandLine " &lt;&lt; "\n"; 
}
</pre></td></tr></tbody></table></code></pre></div></div>
<p>æˆ‘åœ¨verbose.logä¸­æŸ¥çœ‹æ—¥å¿—ï¼Œå‘ç°æ‰€æœ‰dex2oatæ‰§è¡Œï¼Œéƒ½æ²¡æœ‰æœç´¢åˆ°StrippedCommandLineæ—¥å¿—çš„å‡ºç°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ
åœ¨aospä¸­ç¼–è¯‘çš„æ—¶å€™ï¼Œå¹¶æ²¡æœ‰dex2oatå‘½ä»¤æ‰§è¡Œçš„æ—¶å€™èµ°åˆ°elseè¿™ä¸ªä»£ç ä¸­ã€‚
å¦å¤–ï¼Œæˆ‘åœ¨ifåˆ†æ”¯ä¸­çš„æ‰“å°ï¼Œåªå‘ç°äº†å¦‚ä¸‹ä¸¤ç§æ‰“å°</p>
<ol>
  <li>
    <p>dex2oat-&gt;IsBootImage()0dex2oat-&gt;IsHost()0</p>
  </li>
  <li>
    <p>dex2oat-&gt;IsBootImage()1dex2oat-&gt;IsHost()0</p>
  </li>
</ol>

<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨AOSPç¼–è¯‘çš„è¿‡ç¨‹ä¸­ï¼Œæ²¡æœ‰dex2oat-&gt;IsHost()å€¼æ˜¯trueã€‚
åœ¨æ‰€æœ‰dex2oatæ‰§è¡Œçš„æ—¥å¿—ä¸­ï¼Œdex2oat-&gt;IsBootImage()å€¼ä¸ºtrueçš„åœ°æ–¹ï¼Œæ€»å…±æœ‰4å¤„ã€‚</p>

<p>ç¬¬ä¸€å¤„ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
</pre></td> --><td class="rouge-code"><pre>out/soong/host/linux-x86/bin/dex2oatd
--avoid-storing-invocation
--write-invocation-to=out/soong/walleye/dex_apexjars/system/framework/arm/apex.invocation
--runtime-arg
-Xms64m
--runtime-arg
-Xmx64m
--compiler-filter=speed-profile
--profile-file=out/soong/walleye/dex_bootjars/boot.prof
--dirty-image-objects=frameworks/base/config/dirty-image-objects
--dex-file=out/soong/walleye/dex_apexjars_input/core-oj.jar
--dex-file=out/soong/walleye/dex_apexjars_input/core-libart.jar
--dex-file=out/soong/walleye/dex_apexjars_input/okhttp.jar
--dex-file=out/soong/walleye/dex_apexjars_input/bouncycastle.jar
--dex-file=out/soong/walleye/dex_apexjars_input/apache-xml.jar
--dex-file=out/soong/walleye/dex_apexjars_input/framework.jar
--dex-file=out/soong/walleye/dex_apexjars_input/ext.jar
--dex-file=out/soong/walleye/dex_apexjars_input/telephony-common.jar
--dex-file=out/soong/walleye/dex_apexjars_input/voip-common.jar
--dex-file=out/soong/walleye/dex_apexjars_input/ims-common.jar
--dex-file=out/soong/walleye/dex_apexjars_input/android.test.base.jar
--dex-location=/apex/com.android.runtime/javalib/core-oj.jar
--dex-location=/apex/com.android.runtime/javalib/core-libart.jar
--dex-location=/apex/com.android.runtime/javalib/okhttp.jar
--dex-location=/apex/com.android.runtime/javalib/bouncycastle.jar
--dex-location=/apex/com.android.runtime/javalib/apache-xml.jar
--dex-location=/system/framework/framework.jar
--dex-location=/system/framework/ext.jar
--dex-location=/system/framework/telephony-common.jar
--dex-location=/system/framework/voip-common.jar
--dex-location=/system/framework/ims-common.jar
--dex-location=/system/framework/android.test.base.jar
--generate-debug-info
--generate-build-id
--oat-symbols=out/soong/walleye/dex_apexjars_unstripped/system/framework/arm/apex.oat
--strip
--oat-file=out/soong/walleye/dex_apexjars/system/framework/arm/apex.oat
--oat-location=out/soong/walleye/dex_apexjars/system/framework/apex.oat
--image=out/soong/walleye/dex_apexjars/system/framework/arm/apex.art
--base=0x70000000
--instruction-set=arm
--instruction-set-variant=cortex-a73
--instruction-set-features=default
--android-root=out/empty
--no-inline-from=core-oj.jar
--abort-on-hard-verifier-error
--generate-mini-debug-info
</pre></td></tr></tbody></table></code></pre></div></div>

<p>ç¬¬äºŒå¤„ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
</pre></td> --><td class="rouge-code"><pre>out/soong/host/linux-x86/bin/dex2oatd
--avoid-storing-invocation
--write-invocation-to=out/soong/walleye/dex_apexjars/system/framework/arm64/apex.invocation
--runtime-arg
-Xms64m
--runtime-arg 
-Xmx64m
--compiler-filter=speed-profile 
--profile-file=out/soong/walleye/dex_bootjars/boot.prof
--dirty-image-objects=frameworks/base/config/dirty-image-objects
--dex-file=out/soong/walleye/dex_apexjars_input/core-oj.jar
--dex-file=out/soong/walleye/dex_apexjars_input/core-libart.jar
--dex-file=out/soong/walleye/dex_apexjars_input/okhttp.jar
--dex-file=out/soong/walleye/dex_apexjars_input/bouncycastle.jar
--dex-file=out/soong/walleye/dex_apexjars_input/apache-xml.jar
--dex-file=out/soong/walleye/dex_apexjars_input/framework.jar
--dex-file=out/soong/walleye/dex_apexjars_input/ext.jar
--dex-file=out/soong/walleye/dex_apexjars_input/telephony-common.jar
--dex-file=out/soong/walleye/dex_apexjars_input/voip-common.jar
--dex-file=out/soong/walleye/dex_apexjars_input/ims-common.jar
--dex-file=out/soong/walleye/dex_apexjars_input/android.test.base.jar
--dex-location=/apex/com.android.runtime/javalib/core-oj.jar
--dex-location=/apex/com.android.runtime/javalib/core-libart.jar
--dex-location=/apex/com.android.runtime/javalib/okhttp.jar
--dex-location=/apex/com.android.runtime/javalib/bouncycastle.jar
--dex-location=/apex/com.android.runtime/javalib/apache-xml.jar
--dex-location=/system/framework/framework.jar
--dex-location=/system/framework/ext.jar
--dex-location=/system/framework/telephony-common.jar
--dex-location=/system/framework/voip-common.jar
--dex-location=/system/framework/ims-common.jar
--dex-location=/system/framework/android.test.base.jar
--generate-debug-info
--generate-build-id
--oat-symbols=out/soong/walleye/dex_apexjars_unstripped/system/framework/arm64/apex.oat
--strip
--oat-file=out/soong/walleye/dex_apexjars/system/framework/arm64/apex.oat
--oat-location=out/soong/walleye/dex_apexjars/system/framework/apex.oat
--image=out/soong/walleye/dex_apexjars/system/framework/arm64/apex.art
--base=0x70000000
--instruction-set=arm64
--instruction-set-variant=cortex-a73
--instruction-set-features=default
--android-root=out/empty
--no-inline-from=core-oj.jar
--abort-on-hard-verifier-error
--generate-mini-debug-info
</pre></td></tr></tbody></table></code></pre></div></div>

<p>ç¬¬ä¸‰å¤„ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
</pre></td> --><td class="rouge-code"><pre>out/soong/host/linux-x86/bin/dex2oatd
--avoid-storing-invocation
--write-invocation-to=out/soong/walleye/dex_bootjars/system/framework/arm/boot.invocation
--runtime-arg
-Xms64m
--runtime-arg
-Xmx64m
--compiler-filter=speed-profile
--profile-file=out/soong/walleye/dex_bootjars/boot.prof
--dirty-image-objects=frameworks/base/config/dirty-image-objects
--dex-file=out/soong/walleye/dex_bootjars_input/core-oj.jar
--dex-file=out/soong/walleye/dex_bootjars_input/core-libart.jar
--dex-file=out/soong/walleye/dex_bootjars_input/okhttp.jar
--dex-file=out/soong/walleye/dex_bootjars_input/bouncycastle.jar
--dex-file=out/soong/walleye/dex_bootjars_input/apache-xml.jar
--dex-file=out/soong/walleye/dex_bootjars_input/framework.jar
--dex-file=out/soong/walleye/dex_bootjars_input/ext.jar
--dex-file=out/soong/walleye/dex_bootjars_input/telephony-common.jar
--dex-file=out/soong/walleye/dex_bootjars_input/voip-common.jar
--dex-file=out/soong/walleye/dex_bootjars_input/ims-common.jar
--dex-file=out/soong/walleye/dex_bootjars_input/android.test.base.jar
--dex-location=/apex/com.android.runtime/javalib/core-oj.jar
--dex-location=/apex/com.android.runtime/javalib/core-libart.jar
--dex-location=/apex/com.android.runtime/javalib/okhttp.jar
--dex-location=/apex/com.android.runtime/javalib/bouncycastle.jar
--dex-location=/apex/com.android.runtime/javalib/apache-xml.jar
--dex-location=/system/framework/framework.jar
--dex-location=/system/framework/ext.jar
--dex-location=/system/framework/telephony-common.jar
--dex-location=/system/framework/voip-common.jar
--dex-location=/system/framework/ims-common.jar
--dex-location=/system/framework/android.test.base.jar
--generate-debug-info
--generate-build-id
--oat-symbols=out/soong/walleye/dex_bootjars_unstripped/system/framework/arm/boot.oat
--strip
--oat-file=out/soong/walleye/dex_bootjars/system/framework/arm/boot.oat
--oat-location=out/soong/walleye/dex_bootjars/system/framework/boot.oat
--image=out/soong/walleye/dex_bootjars/system/framework/arm/boot.art
--base=0x70000000
--instruction-set=arm
--instruction-set-variant=cortex-a73
--instruction-set-features=default
--android-root=out/empty
--no-inline-from=core-oj.jar
--abort-on-hard-verifier-error
--generate-mini-debug-info
</pre></td></tr></tbody></table></code></pre></div></div>

<p>ç¬¬4å¤„ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
</pre></td> --><td class="rouge-code"><pre>out/soong/host/linux-x86/bin/dex2oatd
--avoid-storing-invocation
--write-invocation-to=out/soong/walleye/dex_bootjars/system/framework/arm64/boot.invocation
--runtime-arg
-Xms64m
--runtime-arg
-Xmx64m
--compiler-filter=speed-profile 
--profile-file=out/soong/walleye/dex_bootjars/boot.prof
--dirty-image-objects=frameworks/base/config/dirty-image-objects
--dex-file=out/soong/walleye/dex_bootjars_input/core-oj.jar
--dex-file=out/soong/walleye/dex_bootjars_input/core-libart.jar
--dex-file=out/soong/walleye/dex_bootjars_input/okhttp.jar
--dex-file=out/soong/walleye/dex_bootjars_input/bouncycastle.jar
--dex-file=out/soong/walleye/dex_bootjars_input/apache-xml.jar
--dex-file=out/soong/walleye/dex_bootjars_input/framework.jar
--dex-file=out/soong/walleye/dex_bootjars_input/ext.jar
--dex-file=out/soong/walleye/dex_bootjars_input/telephony-common.jar
--dex-file=out/soong/walleye/dex_bootjars_input/voip-common.jar
--dex-file=out/soong/walleye/dex_bootjars_input/ims-common.jar
--dex-file=out/soong/walleye/dex_bootjars_input/android.test.base.jar
--dex-location=/apex/com.android.runtime/javalib/core-oj.jar
--dex-location=/apex/com.android.runtime/javalib/core-libart.jar
--dex-location=/apex/com.android.runtime/javalib/okhttp.jar
--dex-location=/apex/com.android.runtime/javalib/bouncycastle.jar
--dex-location=/apex/com.android.runtime/javalib/apache-xml.jar
--dex-location=/system/framework/framework.jar
--dex-location=/system/framework/ext.jar
--dex-location=/system/framework/telephony-common.jar
--dex-location=/system/framework/voip-common.jar
--dex-location=/system/framework/ims-common.jar
--dex-location=/system/framework/android.test.base.jar
--generate-debug-info
--generate-build-id
--oat-symbols=out/soong/walleye/dex_bootjars_unstripped/system/framework/arm64/boot.oat
--strip
--oat-file=out/soong/walleye/dex_bootjars/system/framework/arm64/boot.oat
--oat-location=out/soong/walleye/dex_bootjars/system/framework/boot.oat
--image=out/soong/walleye/dex_bootjars/system/framework/arm64/boot.art
--base=0x70000000
--instruction-set=arm64
--instruction-set-variant=cortex-a73
--instruction-set-features=default
--android-root=out/empty
--no-inline-from=core-oj.jar
--abort-on-hard-verifier-error
--generate-mini-debug-info
</pre></td></tr></tbody></table></code></pre></div></div>

<p>è¿™4å¤„åˆ†åˆ«é’ˆå¯¹armå’Œarm64ï¼Œè¿™å››å¤„ä¸­â€“profile-file=out/soong/walleye/dex_bootjars/boot.profæ˜¯ä¸€æ ·çš„ã€‚
æˆ‘ä»¬å¯¹æ¯”ä¸‹ç¬¬ä¸€å¤„å’Œç¬¬ä¸‰å¤„è¿™ä¸ªarmçš„æ¥åˆ†æä¸‹ï¼š
â€“profile-fileçš„å€¼æ˜¯ä¸€æ ·çš„ï¼Œâ€“dex-fileçœ‹ä¼¼ä¸ä¸€æ ·ï¼Œæ¯”å¦‚ä¸€ä¸ª
æ˜¯out/soong/walleye/dex_bootjars_input/core-oj.jarï¼Œå¦ä¸€ä¸ªä¸­æ˜¯ â€“dex-file=out/soong/walleye/dex_apexjars_input/core-oj.jar
ï¼Œä¸åŒç›®å½•ä¸‹çš„åŒåjaråŒ…ã€‚
æˆ‘ä½¿ç”¨md5sumæ¯”è¾ƒäº†ä¸‹ï¼Œå‘ç°ä»–ä»¬çš„md5å€¼æ˜¯ä¸€æ ·çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸¤ä¸ªjaråŒ…æ˜¯ä¸€æ ·çš„ã€‚
é‚£ç”Ÿæˆçš„oatæ–‡ä»¶ä¸€æ ·å—ï¼Ÿ</p>

<p>â€“oat-file=out/soong/walleye/dex_apexjars/system/framework/arm/apex.oat</p>

<p>â€“oat-file=out/soong/walleye/dex_bootjars/system/framework/arm/boot.oat</p>

<p>ä¸Šé¢è¿™ä¸¤ä¸ªä¸€æ ·å—ï¼Ÿæˆ‘md5sumäº†ä¸€ä¸‹ï¼Œå‘ç°ä»–ä»¬ä¸ä¸€æ ·ï¼Œè¿™å°±å¾ˆå¥‡æ€ªäº†ï¼Œæ€€ç–‘æ˜¯æ–‡ä»¶å¤´å†™å…¥äº†æ—¶é—´æˆ–è€…æ˜¯æ–‡ä»¶åå¯¼è‡´md5sumä¸ä¸€æ ·ï¼Œå¾ˆå¯èƒ½å†…å®¹æ˜¯ä¸€æ ·çš„ã€‚
æ‰€ä»¥æˆ‘å¯¹ä»–ä»¬åˆ†åˆ«ä½œäº†</p>

<p>./out/host/linux-x86/bin/oatdump â€“oat-file=out/soong/walleye/dex_bootjars/system/framework/arm/boot.oat â€“header-only</p>

<p>./out/host/linux-x86/bin/oatdump â€“oat-file=out/soong/walleye/dex_apexjars/system/framework/arm/apex.oat â€“header-only</p>

<p>è¾“å‡ºä»–ä»¬çš„æ–‡ä»¶å¤´</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
</pre></td> --><td class="rouge-code"><pre>AGIC:
oat
170

LOCATION:
out/soong/walleye/dex_bootjars/system/framework/arm/boot.oat

CHECKSUM:
0x57acb3eb

INSTRUCTION SET:
Thumb2

INSTRUCTION SET FEATURES:
div,atomic_ldrd_strd,armv8a

DEX FILE COUNT:
1

EXECUTABLE OFFSET:
0x000b5000

JNI DLSYM LOOKUP OFFSET:
0x000b5001

QUICK GENERIC JNI TRAMPOLINE OFFSET:
0x000b5009

QUICK IMT CONFLICT TRAMPOLINE OFFSET:
0x000b5011

QUICK RESOLUTION TRAMPOLINE OFFSET:
0x000b5019

QUICK TO INTERPRETER BRIDGE OFFSET:
0x000b5021

KEY VALUE STORE:
bootclasspath = /apex/com.android.runtime/javalib/core-oj.jar:/apex/com.android.runtime/javalib/core-libart.jar:/apex/com.android.runtime/javalib/okhttp.jar:/apex/com.android.runtime/javalib/bouncycastle.jar:/apex/com.android.runtime/javalib/apache-xml.jar:/system/framework/framework.jar:/system/framework/ext.jar:/system/framework/telephony-common.jar:/system/framework/voip-common.jar:/system/framework/ims-common.jar:/system/framework/android.test.base.jar
compiler-filter = speed-profile
concurrent-copying = true
debuggable = false
native-debuggable = false

SIZE:
2958834

.data.bimg.rel.ro: empty.

.bss: 18 methods, 242 GC roots.
</pre></td></tr></tbody></table></code></pre></div></div>

<p>å¦ä¸€ä¸ªæ–‡ä»¶å¤´</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
</pre></td> --><td class="rouge-code"><pre>AGIC:
oat
170

LOCATION:
out/soong/walleye/dex_apexjars/system/framework/arm/apex.oat

CHECKSUM:
0x57acb3eb

INSTRUCTION SET:
Thumb2

INSTRUCTION SET FEATURES:
div,atomic_ldrd_strd,armv8a

DEX FILE COUNT:
1

EXECUTABLE OFFSET:
0x000b5000

JNI DLSYM LOOKUP OFFSET:
0x000b5001

QUICK GENERIC JNI TRAMPOLINE OFFSET:
0x000b5009

QUICK IMT CONFLICT TRAMPOLINE OFFSET:
0x000b5011

QUICK RESOLUTION TRAMPOLINE OFFSET:
0x000b5019

QUICK TO INTERPRETER BRIDGE OFFSET:
0x000b5021

KEY VALUE STORE:
bootclasspath = /apex/com.android.runtime/javalib/core-oj.jar:/apex/com.android.runtime/javalib/core-libart.jar:/apex/com.android.runtime/javalib/okhttp.jar:/apex/com.android.runtime/javalib/bouncycastle.jar:/apex/com.android.runtime/javalib/apache-xml.jar:/system/framework/framework.jar:/system/framework/ext.jar:/system/framework/telephony-common.jar:/system/framework/voip-common.jar:/system/framework/ims-common.jar:/system/framework/android.test.base.jar
compiler-filter = speed-profile
concurrent-copying = true
debuggable = false
native-debuggable = false

SIZE:
2958834

.data.bimg.rel.ro: empty.

.bss: 18 methods, 242 GC roots.
</pre></td></tr></tbody></table></code></pre></div></div>

<p>æˆ‘ä»¬å‘ç° LOCATION:è¿™ä¸ªå†…å®¹ä¸ä¸€è‡´ï¼Œå…¶ä»–çš„å†…å®¹æ˜¯ä¸€æ ·çš„ï¼Œæ–‡ä»¶å¤´ä¸­è®°å½•çš„checksumæ˜¯ä¸€æ ·çš„ã€‚</p>

<p>æ‰€ä»¥ï¼Œè¿™ä¸¤ä¸ªoatæ–‡ä»¶é™¤äº†æ–‡ä»¶å¤´ä¸­è®°å½•çš„LOCATIONå†…å®¹ä¸ä¸€è‡´ï¼Œå…¶ä½™å†…å®¹éƒ½æ˜¯ä¸€æ ·çš„ã€‚</p>

<p>apexæ˜¯è°·æ­Œç”¨æ¥æ›´å¥½ç®¡æ§androidï¼Œå…·ä½“çš„å‚é˜…å®˜æ–¹æ–‡æ¡£ã€‚</p>

:ET