<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="pv-cache-enabled" content="false"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Thread Local Storage" /><meta name="author" content="zjh" /><meta property="og:locale" content="en_US" /><meta name="description" content="Thread Control Block TCB" /><meta property="og:description" content="Thread Control Block TCB" /><link rel="canonical" href="/posts/thread-local-storage/" /><meta property="og:url" content="/posts/thread-local-storage/" /><meta property="og:site_name" content="Zhenghanhan Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-07-20T00:00:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Thread Local Storage" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@zjh" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"zjh"},"headline":"Thread Local Storage","dateModified":"2020-07-20T00:00:00+08:00","datePublished":"2020-07-20T00:00:00+08:00","url":"/posts/thread-local-storage/","description":"Thread Control Block TCB","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/thread-local-storage/"},"@context":"https://schema.org"}</script><title>Thread Local Storage | Zhenghanhan Blog</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=default"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://cdn.jsdelivr.net/gh/cotes2020/chirpy-images/commons/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Zhenghanhan Blog</a></div><div class="site-subtitle font-italic">Never Cease to be Eager to Techniques</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/github_username" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['alanwilliams','foxmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Thread Local Storage</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Thread Local Storage</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Mon, Jul 20, 2020, 12:00 AM +0800" > Jul 20, 2020 <i class="unloaded">2020-07-20T00:00:00+08:00</i> </span> by <span class="author"> zjh </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1941 words">10 min</span></div></div><div class="post-content"><p>Thread Control Block TCB</p><p>https://docs.oracle.com/cd/E23824_01/html/819-0690/gentextid-22428.html#scrolltoc</p><h2 id="chapter-2-link-editor">Chapter 2 Link Editor</h2><h3 id="symbol-processing">Symbol Processing</h3><blockquote><p>During input file processing, local symbols are copied from any input relocatable object files to the output object being built, <strong>without examination.</strong></p></blockquote><blockquote><p>The global symbols from all input relocatable objects, and the global symbols from any external dependencies, are analyzed and combined in a process known as <strong>symbol resolution</strong>. The link-editor <strong>places each symbol in an internal symbol table</strong> in the order that the symbols are encountered. If a symbol with the same name was contributed by an earlier object, and already exists in the symbol table, the symbol resolution process <strong>determines which</strong> of the two symbols to keep. As a side effect of this process, the link-editor determines how to establish references to external object dependencies.</p></blockquote><h4 id="symbol-resolution">Symbol Resolution</h4><blockquote><p>The most common simple resolutions involve binding symbol references from one object to symbol definitions within another object. This binding can occur between two relocatable objects, or between a relocatable object and the first definition found in a shared object dependency.</p></blockquote><p>three basic symbol types</p><ol><li><p><strong>Undefined</strong> – Symbols that have been referenced in a file but have not been assigned a storage address.</p><li><p><strong>Tentative</strong> – Symbols that have been created within a file but have not yet been sized, or allocated in storage. These symbols appear as uninitialized C symbols, or FORTRAN COMMON blocks within the file.</p><li><p><strong>Defined</strong> – Symbols that have been created, and assigned storage addresses and space within the file.</p></ol><blockquote><p>In its simplest form, symbol resolution involves the use of a <strong>precedence</strong> relationship. This relationship has <strong>defined</strong> symbols dominate <strong>tentative</strong> symbols, which in turn dominate <strong>undefined</strong> symbols</p></blockquote><h2 id="runtime-linker">Runtime Linker</h2><blockquote><p>As part of the initialization and execution of an executable, an <strong>interpreter</strong> is called to complete the binding of the application to its dependencies. In the Oracle Solaris OS, this interpreter is referred to as the <strong>runtime linker</strong>. During the link-editing of an executable, <strong>a special .interp section</strong>, together with an associated program header, are created. This section contains a path name specifying the program’s interpreter. The default name supplied by the link-editor is the name of the runtime linker: /usr/lib/ld.so.1 for a 32-bit executable and /usr/lib/64/ld.so.1 for a 64-bit executable. During the process of <strong>executing a dynamic object</strong>, the kernel loads the file and reads the program header information. See “Program Header” on page 435. From this information, <strong>the kernel locates the name of the required interpreter. The kernel loads, and transfers control to this interpreter, passing sufficient information to enable the interpreter to continue executing the application.</strong></p></blockquote><p>runtime linker的功能</p><p>The runtime linker performs the following actions.</p><ol><li>Analyzes the executable’s dynamic information section (.dynamic) and determines what dependencies are required.<li>Locates and loads these dependencies, analyzing their dynamic information sections to determine if any additional dependencies are required.<li>Performs any necessary relocations to bind these objects in preparation for process execution.<li>Calls any initialization functions provided by the dependencies.<li>Passes control to the application.<li>Can be called upon during the application’s execution, to perform any delayed function binding.<li>Can be called upon by the application to acquire additional objects with dlopen(3C), and bind to symbols within these objects with dlsym(3C).</ol><p>runtime linker查找路径：</p><ol><li>首先查找的是 LD_LIBRARY_PATH这个环境变量指定的目录下的so<li>如果步骤1中没有搜索到，那则搜索runpath目录下的so。link-edit阶段写入object中.dynamic段中的某个entry，这个entry的tag是RUNPATH，指定了搜索路径<li>如果步骤2中也没有搜索到，那么就搜索默认路径，32bit系统默认搜索/lib and /usr/lib, 64bit系统默认搜索/lib/64 and /usr/lib/64路径</ol><p>the use of LD_LIBRARY_PATH is strongly discouraged in production software</p><h3 id="relocation-processing">Relocation Processing</h3><blockquote><p>After the runtime linker has loaded all the dependencies required by an application, the linker processes each object and performs all necessary relocations.</p></blockquote><blockquote><p>During the link-editing of an object, any relocation information supplied with the input relocatable objects is applied to the output file. However, when creating a dynamic object, many of the relocations <strong>cannot be completed</strong> at link-edit time. These relocations require logical addresses that are known only when the objects are loaded into memory. In these cases, the <strong>link-editor</strong> generates <strong>new relocation records</strong> as part of the output file image. The <strong>runtime linker</strong> must then <strong>process</strong> these new relocation records.</p></blockquote><p>Two basic types of relocation exist.</p><ol><li>Non-symbolic relocations<li>Symbolic relocations</ol><p>With this model, the first occurrence of the required symbol satisfies the search. Therefore, if more than one instance of the same symbol exists, the first instance interposes on all others.</p><h3 id="initialization-and-termination-routines">Initialization and Termination Routines</h3><p>Dynamic objects can supply code that provides for runtime initialization and termination processing. The initialization code of a dynamic object is executed once each time the dynamic object is loaded in a process. The termination code of a dynamic object is executed once each time the dynamic object is unloaded from a process or at process termination.</p><p>Before transferring control to an application, the runtime linker processes any initialization sections found in the application and any loaded dependencies. If new dynamic objects are loaded during process execution, their initialization sections are processed as part of loading the object. The initialization sections .preinit_array, .init_array, and .init are created by the link-editor when a dynamic object is built.</p><p>An executable can provide pre-initialization functions in a .preinit_array section. These functions are executed after the runtime linker has built the process image and performed relocations but before any other initialization functions. Pre-initialization functions are not permitted in shared objects. Note - Any .init section within the executable is called from the application by the process startup mechanism supplied by the compiler driver. The .init section within the executable is called last, after all dependency initialization sections are executed.</p><h2 id="shared-objects">Shared Objects</h2><blockquote><p>Shared objects are one form of output created by the link-editor and are generated by specifying the -G option. A shared object is an indivisible unit that is generated from one or more relocatable objects. Shared objects can be bound with executables to form a runnable process. As their name implies, shared objects can be shared by more than one application</p></blockquote><blockquote><p>Any input shared objects become dependencies of this output file. A small amount of bookkeeping information is maintained within the output file to describe these dependencies. The runtime linker interprets this information and completes the processing of these shared objects as part of creating a runnable process.</p></blockquote><p>During the link-edit of a shared object, its runtime name can be recorded within the shared object itself by using the -h option. In the following example, the shared object’s runtime name libfoo.so.1, is recorded within the file itself. This identification is known as an soname.</p><h4 id="relocation-sections">Relocation Sections</h4><blockquote><p><strong>Relocation is the process of connecting symbolic references with symbolic definitions</strong>. For example, when a program calls a function, <strong>the associated call instruction must transfer control to the proper destination address at execution</strong>. Relocatable files must have information that describes how to modify their section contents. This information allows dynamic object files to <strong>hold the right information</strong> for a process’s program image. <strong>Relocation entries are these data</strong>.</p></blockquote><p>sys/elf.h</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre>typedef struct {
        Elf32_Addr      r_offset;
        Elf32_Word      r_info;
} Elf32_Rel;

typedef struct {
        Elf32_Addr      r_offset;
        Elf32_Word      r_info;
        Elf32_Sword     r_addend;
} Elf32_Rela;

typedef struct {
        Elf64_Addr      r_offset;
        Elf64_Xword     r_info;
} Elf64_Rel;

typedef struct {
        Elf64_Addr      r_offset;
        Elf64_Xword     r_info;
        Elf64_Sxword    r_addend;
} Elf64_Rela;
</pre></table></code></div></div><p><strong>r_offset</strong> This member gives the location at which to apply the relocation action. Different object files have slightly different interpretations for this member.</p><p>For a relocatable file, the value indicates a section offset. The relocation section describes how to modify another section in the file. Relocation offsets designate a storage unit within the second section. 就是说，这个offset描述了如何修改另一个段中offset处的一块内存区域。</p><p>For a dynamic object, the value indicates the virtual address of the storage unit affected by the relocation. This information makes the relocation entries more useful for the runtime linker. 对于动态对象来说，这个值指示了受重定位影响的存储单元的虚拟地址，对runtime linker来说，该重定位条目非常有用。</p><p>Although the interpretation of the member changes for different object files to allow efficient access by the relevant programs, the meanings of the relocation types stay the same.</p><h3 id="program-loading-and-dynamic-linking">Program Loading and Dynamic Linking</h3><p>Executables and shared objects <strong>statically represent</strong> application programs. To execute such programs, the system uses the objects to create <strong>dynamic program representations, or process images</strong>. A process image has segments that contain its text, data, stack, and so on.</p><h4 id="base-address">Base Address</h4><p>Dynamic objects have a base address, which is the lowest virtual address associated with the memory image of the program’s object file. One use of the base address is to <strong>relocate</strong> the memory image of the program during dynamic linking.</p><p><strong>The base address of a dynamic object is calculated during execution from three values</strong>: the memory load address, the maximum page size, and the lowest virtual address of a program’s loadable segment. The virtual addresses in the program headers might not represent the actual virtual addresses of the program’s memory image. 在执行期间，一个动态对象的基址是根据这三个值计算出来的*****</p><h4 id="segment-contents">Segment Contents</h4><p>An object file segment consists of one or more sections, though this fact is transparent to the program header. Whether the file segment holds one section or many sections, is also immaterial to program loading.</p><h3 id="program-loading">Program Loading</h3><p>As the system creates or augments a process image, the system <strong>logically</strong> copies a file’s segment to a virtual memory segment. When, and if, the system <strong>physically</strong> reads the file depends on the program’s execution behavior, system load, and so forth.</p><p>A process does not require a physical page <strong>unless</strong> the process <strong>references</strong> the logical page during execution. Processes commonly leave many pages <strong>unreferenced</strong>. Therefore, delaying physical reads can improve system performance. To obtain this efficiency in practice, dynamic objects must have segment images whose file offsets and virtual addresses are <strong>congruent</strong>, <strong>modulo</strong> the page size.</p><hr /><ol><li>Historically, weak symbols have been used to <strong>circumvent interposition</strong>, or test for optional functionality.<li>Although this archive extraction can be achieved by specifying multiple -u options to the link-edit, this example also shows how the <strong>eventual scope</strong> of a symbol can be reduced to local.</ol><p>These environment variables <strong>are well suited to</strong> debugging purposes, such as forcing an application to bind to a local dependency.</p><p>However, this compensation can undermine the advantages of a lazy loading.</p><p>Neither the link-editor nor the runtime linker interprets any file by virtue of its file name</p><p>Whether the file segment holds one section or many sections, is also <strong>immaterial</strong> to program loading.</p><p>error: RPC failed; curl 56 GnuTLS recv error (-9): Error decoding the received TLS packet.</p><p>fatal: The remote end hung up unexpectedly. fatal: early EOF fatal: index-pack failed</p><p>乱码的解决方案 alias tree=’tree –charset ASCII’</p><p>驱动处理方式 http://blog.leanote.com/post/yangtianrui95@gmail.com/AOSP-%E5%BC%80%E5%8F%91%E5%B9%B6%E5%88%B7%E5%85%A5Pixel</p><p>tar zxvf qcom-walleye-qq3a.200705.002-b7555c81.tgz</p><p>tar zxvf google_devices-walleye-qq3a.200705.002-42602ba1.tgz</p><p>m -j8</p></div><div class="post-tail-wrapper text-muted"><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Thread Local Storage - Zhenghanhan Blog&url=/posts/thread-local-storage/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Thread Local Storage - Zhenghanhan Blog&u=/posts/thread-local-storage/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Thread Local Storage - Zhenghanhan Blog&url=/posts/thread-local-storage/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/2019-12-30-computer-books.html">计算机专业好书推荐</a><li><a href="/posts/available-expression-analysis/">Dataflow Analysis中的Available Expressions Analysis</a><li><a href="/posts/graph-basics/">图相关知识回顾</a><li><a href="/posts/anticipable-expressions-analysis/">Dataflow Analysis中的Anticipable Expressions Analysis</a><li><a href="/posts/llvm_getting_started/">LLVM学习开动篇</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/default/">default</a> <a class="post-tag" href="/tags/art/">art</a> <a class="post-tag" href="/tags/compiler/">compiler</a> <a class="post-tag" href="/tags/llvm/">llvm</a> <a class="post-tag" href="/tags/getting-started/">getting_started</a> <a class="post-tag" href="/tags/theory/">theory</a> <a class="post-tag" href="/tags/general/">general</a> <a class="post-tag" href="/tags/graph/">graph</a> <a class="post-tag" href="/tags/jni/">jni</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/2020-12-06-simple-example.html"><div class="card-body"> <span class="timeago small" > Dec 6, 2020 <i class="unloaded">2020-12-06T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>通过例子查看编译器编译流程</h3><div class="text-muted small"><p> 简介 下面我们通过一个小例子来学习下编译器处理相关小知识 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 5...</p></div></div></a></div><div class="card"> <a href="/2020-09-07-libart-so.html"><div class="card-body"> <span class="timeago small" > Sep 7, 2020 <i class="unloaded">2020-09-07T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>加载libart.so步骤</h3><div class="text-muted small"><p> 简介 我们知道，java虚拟机一般都是以动态库的形式暴露给外界，供外部开发者来集成使用的。 在art中，它的文件名叫做libart.so app_process这个程序集成了libart.so，并以zygote的形式运行起来，作为后续所有的安卓应用进程 的父进程 我们看下上图中的1172行，这里 jni_invocation.Init(NULL); 里面会加载虚拟机所在的动态库li...</p></div></div></a></div><div class="card"> <a href="/2020-09-10-app-start.html"><div class="card-body"> <span class="timeago small" > Sep 7, 2020 <i class="unloaded">2020-09-07T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>应用启动流程分析</h3><div class="text-muted small"><p> ZygoteInit.main 我们知道，虚拟机创建后，执行的第一个java代码是ZygoteInit的main方法，我们来看下这个方法内部的一些主要代码： 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 ... zygoteServer = new ZygoteServer(isPrimaryZygote)...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/2020-07-16-jni_getting_started.html" class="btn btn-outline-primary" prompt="Older"><p>JNI学习开动篇</p></a> <a href="/2020-07-27-aosp_build.html" class="btn btn-outline-primary" prompt="Newer"><p>AOSP源码下载、编译与刷机</p></a></div></div></div></div><script type="text/javascript">document.write(unescape("%3Cspan id='cnzz_stat_icon_1279683720'%3E%3C/span%3E%3Cscript src='https://s9.cnzz.com/z_stat.php%3Fid%3D1279683720%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));</script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="">zjh</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">All rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/default/">default</a> <a class="post-tag" href="/tags/art/">art</a> <a class="post-tag" href="/tags/compiler/">compiler</a> <a class="post-tag" href="/tags/llvm/">llvm</a> <a class="post-tag" href="/tags/getting-started/">getting_started</a> <a class="post-tag" href="/tags/theory/">theory</a> <a class="post-tag" href="/tags/general/">general</a> <a class="post-tag" href="/tags/graph/">graph</a> <a class="post-tag" href="/tags/jni/">jni</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
